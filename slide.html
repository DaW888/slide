<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <meta name="author" content="Dawid Wajda" />
    <meta name="description" content="3ic2" />
	<title>Strona</title>
	
	<style>
		*{
			margin: 0 auto;
			padding: 0;
		}

		body{
			background-color: rgb(26, 26, 27);
		}

		header > img{
			width: 150px;
			height: 150px;
			margin: 10px auto;
			display: block;
			border: 2px solid rgb(0, 160, 255);
		}

		#buttony{
			margin: 12px auto;
			display: block;
			text-align: center;
		}
		#buttony > button{
			margin: 0 5px;
			padding: 1px 2px;
			background-color: transparent;
			color: aqua;
			font-size: 14px;
			border: 2px outset rgb(0, 160, 255);
		}

		#timer{
			color: white;
			font-size: 20px;
			margin: auto;
			display: block;
			text-align: center;

		}
		#game{
			width: 600px;
			height: 600px;
			margin: 20px auto;
			display: block;
			border: 2px solid aqua;
		}

		#game > div{
			margin: 0;
			float: left;
			color: whitesmoke;
			text-align: center;
			vertical-align: middle;
			font-family: 'Courier New', Courier, monospace;
			font-weight: 600;
			text-shadow: 1px 1px 3px black;
			
		}

	</style>
    <script>
		
		// changePhoto() - zmiana zdjecia po kliknieciu zdj w headerze 
		// createDom() - tworzenie szkieletu strony, zmiana poziomu trudnosci
		// loadPhoto() - ładowanie zdjecia do Headera
		// losowanyObraz() - cięcie obrazu na podstawie tego ktory znajduje sie w headerze
		// move() - po kliknieciu na div z fragmentem obrazka to jest on przesuwany w wolne pole
		// pomusz() - dodane cyferek do fragmentow by łatwiej sie połapać (właczane przyciskiem)
		// run() - wywołanie wszystkich funkcji
		// timer() - div z timerem
		// wyswietlUkladanke() - wyswietlanie ukladanki na podstawie tablicy pozycji (tabpoz) oraz elementow z słownika

		/*
		Do zrobienia
			+ algorytm mieszający
			+ stoper
			+ cookies z wynikami
			+ po 100 ruchach pojawia sie przycisk 'pomóc' albo i nie
		*/
      function ready() {
        slide = {
			run: function (){
				this.createDom()
				this.loadphoto()
				this.timer()
				this.losowanyObraz()
				this.changePhoto()
			},


			nrZdj: 4,
			poziomTrudnosci: 4,
			tabPoz: [],
			slownik:{},
			cyferki: false,


			changePhoto: function(){
				var ilObrazkow = 4
				var obrazek = document.getElementsByTagName('header')[0].firstChild
				obrazek.addEventListener('click', () =>{
					this.nrZdj ++
					if (this.nrZdj > ilObrazkow) this.nrZdj = 1 
					document.getElementsByTagName('header')[0].firstChild.src = `p${this.nrZdj}.jpg`
					document.getElementById('game').innerHTML = ''
					this.losowanyObraz()
				})
			},


			createDom: function(){
				el = document.createElement('header')
				document.body.appendChild(el)

				tablicaElementow = ['buttony', 'timer', 'game']
				for(var i = 0; i<tablicaElementow.length; i++){
					el = document.createElement('div')
					el.id = tablicaElementow[i]
					document.body.appendChild(el)
				}

				var tabInner = ['3 x 3', '4 x 4', '5 x 5', '6 x 6']
				var tabId = [3, 4, 5, 6]
				for(let i=0; i<tabId.length; i++){
					var btn = document.createElement('button')
					var t = document.createTextNode(tabInner[i])
					btn.appendChild(t)
					btn.id = 'b'+tabId[i]
					document.getElementById('buttony').appendChild(btn)
					
					btn.onclick = () => {
						this.poziomTrudnosci= tabId[i]
						document.getElementById('game').innerHTML = ''
						this.losowanyObraz()
						this.wyswietlUkladanke()
						this.mieszaj()
					}
				}

				btn = document.createElement('button')
				btn.id = 'pomoc'
				t = document.createTextNode('Pomóc?')
				btn.appendChild(t)
				document.getElementById('buttony').appendChild(btn)
				btn.onclick = () => {
						this.cyferki = !this.cyferki
						for(i=0; i<this.poziomTrudnosci**2; i++)
							document.getElementById('game').children[i].innerHTML = ''
						this.wyswietlUkladanke()
					}
			},


            loadphoto: function(){
                obraz = document.createElement("img")
                obraz.src = `p${this.nrZdj}.jpg`
				document.getElementsByTagName('header')[0].appendChild(obraz)
			},


			timer: function (){
				el = document.createElement('p')
				el.innerHTML = 'Zegarmistrz światła purpurowy'
				document.getElementById('timer').appendChild(el)
			},


			losowanyObraz: function () {
				this.slownik = {}
				this.tabPoz = []
				for(var i=0; i<this.poziomTrudnosci+2; i++){
					this.tabPoz[i] = []
					for(var j=0; j<this.poziomTrudnosci+2; j++)
						this.tabPoz[i][j]= -1
				}
				var l = 1
				for(var i=1; i<this.poziomTrudnosci+1; i++){
					for(var j=1; j<this.poziomTrudnosci+1; j++){
						if(i==this.poziomTrudnosci && j==this.poziomTrudnosci)
							this.tabPoz[i][j] = 0
						else
							this.tabPoz[i][j] = l
						l++
					}
				}
				l = 1
				for (var i = 0; i < this.poziomTrudnosci; i++) {
					for (var j = 0; j < this.poziomTrudnosci; j++) {
						var el = document.createElement('div')
						el.style.width = String(600 / this.poziomTrudnosci) + 'px'
						el.style.height = String(600 / this.poziomTrudnosci) + 'px' // line-height: 100px;
						el.style.lineHeight = String(600 / this.poziomTrudnosci) + 'px'
						el.style.fontSize = 140/this.poziomTrudnosci+'px'

						if (i * j != (this.poziomTrudnosci - 1)**2) {
							el.id = l
							this.slownik[l] = el
							el.style.backgroundImage = `url(p${this.nrZdj}.jpg)`;
							el.style.backgroundSize = '600px 600px'
							el.style.backgroundPosition = `-${600 / this.poziomTrudnosci * j}px -${600 / this.poziomTrudnosci * i}px`
						} else {
							el.id = 0;
							this.slownik[0] = el;
							el.style.backgroundColor = 'transparent'
						}
						el.onclick = this.move
						l++
					}
				}

				//console.log(this.slownik)
				this.wyswietlUkladanke()
			},


			wyswietlUkladanke: function (){
				for(var i = 1; i < this.tabPoz.length - 1; i++){
					for(var j = 1; j < this.tabPoz[i].length - 1; j++){
						document.getElementById('game').appendChild(this.slownik[this.tabPoz[i][j]])	
					}
				}
				if(this.cyferki)
					this.pomusz()
			},


			pomusz: function () {
				for(var i = 1; i < this.poziomTrudnosci+1; i++){
					for(var j = 1; j < this.poziomTrudnosci+1; j++){
						if (this.tabPoz[i][j] == 0)		document.getElementById(0).innerText = '' //this.poziomTrudnosci**2 - jesli chce cyfre w pustym
						else	document.getElementById(this.tabPoz[i][j]).innerText = this.tabPoz[i][j]	
					}
				}	
			},


			move: function(){
				var clicked = this.id
				console.log(slide.tabPoz)
				wyjdz = false
				for(var i=1; i<slide.poziomTrudnosci+1; i++){
					for(var j=1; j<slide.poziomTrudnosci+1; j++){
						if(clicked == slide.tabPoz[i][j]){
							if(slide.tabPoz[i][j+1] == 0){
								slide.tabPoz[i][j+1] = slide.tabPoz[i][j]
								slide.tabPoz[i][j] = 0
								console.log('lewy')
								wyjdz = true
								break
							}else if(slide.tabPoz[i+1][j] == 0){
								slide.tabPoz[i+1][j] = slide.tabPoz[i][j]
								slide.tabPoz[i][j] = 0
								console.log('gora')
								wyjdz = true
								break
							}else if(slide.tabPoz[i-1][j] == 0){
								slide.tabPoz[i-1][j] = slide.tabPoz[i][j]
								slide.tabPoz[i][j] = 0
								console.log('dol')
								wyjdz = true
								break
							}else if(slide.tabPoz[i][j-1] == 0){
								slide.tabPoz[i][j-1] = slide.tabPoz[i][j]
								slide.tabPoz[i][j] = 0
								console.log('prawo')
								wyjdz = true
								break
								
							}
						}
					}
					if(wyjdz) break
				}
				slide.wyswietlUkladanke()

			},

			mieszaj: function () {
				var przeciwnyKier = 0
				for(var r = 0; r < this.poziomTrudnosci **2 * 10; r++){
					var kierunek = Math.floor(Math.random() * 4 + 1) 	//lewo-1, prawo-2, gora-3, dol-4
					
					while(kierunek == przeciwnyKier)
						kierunek = Math.floor(Math.random() * 4 + 1)

					for (var i = 0; i < this.poziomTrudnosci + 1; i++) {
						for (var j = 0; j < this.poziomTrudnosci + 1; j++) {
							if (this.tabPoz[i][j] == 0) {
							
								if (kierunek == 1 && this.tabPoz[i][j - 1] > 0) {	//lewo
									console.log('przesuniecie w lewo')
									this.tabPoz[i][j] = this.tabPoz[i][j - 1]
									this.tabPoz[i][j - 1] = 0
									przeciwnyKier = 2
								} else if (kierunek == 2 && this.tabPoz[i][j + 1] > 0) {	//prawo
									console.log('przesuniecie w prawo')
									this.tabPoz[i][j] = this.tabPoz[i][j + 1]
									this.tabPoz[i][j + 1] = 0
									przeciwnyKier = 1
								} else if (kierunek == 3 && this.tabPoz[i - 1][j] > 0) {	//gora
									console.log('przesuniecie w gore')
									this.tabPoz[i][j] = this.tabPoz[i - 1][j]
									this.tabPoz[i - 1][j] = 0
									przeciwnyKier = 4
								} else if (kierunek == 4 && this.tabPoz[i + 1][j] > 0) {	//dol
									console.log('przesuniecie w dol')
									this.tabPoz[i][j] = this.tabPoz[i + 1][j]
									this.tabPoz[i + 1][j] = 0
									przeciwnyKier = 3
								}
								//console.log(kierunek); console.log(this.tabPoz);
							}
						}
					}
				}
				this.wyswietlUkladanke()
			}
        
	
		}

      slide.run()
      
      
      }
      document.addEventListener("DOMContentLoaded", ready);
    </script>
  </head>
  <body>
  </body>
</html>